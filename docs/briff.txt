











전략 개요: 12개월 절대모멘텀>0, 가격>EMA60 필터를 통과한 구간에서 MACD 계열 피처(macd, macd_delta, macd_hist)를 입력으로 3개월 후 KOSPI 대비 초과수익 확률을 로지스틱 회귀로 추정하고, buy_proba로 매수 신호를 랭킹/컷오프한다.
라벨 정의: 진입일 대비 63영업일 후 주식 수익률 – 동일 기간 KOSPI 수익률 > 0이면 1. 기간은 2017~2022년.
데이터 파이프라인: 가격/지표(MA 5/10/20/50/60/120/200, MACD, macd_hist) DB 저장 후, KOSPI 지수(벤치마크)는 yfinance로 다운로드해 kospi_close로 병합.
모델 결과(요약): 시계열 CV 정확도 ~0.51–0.55, 학습 샘플 약 29만 건. 확률 분포가 0.5–0.55에 몰려 있고 0.6 이상 신호는 40건뿐 → 신호 강도 약함.
임계값 검토: buy_proba >= 0.55 필터 시 약 9천 건, 0.6 이상은 샘플 부족. 일자별 상위 N 랭킹이나 0.55~0.58 컷을 검토 필요.
리스크/편향: 상장 짧은 티커는 룩백 부족으로 제외(생존 편향 가능), 크로스섹션 누수 가능성 → 날짜 기반 워크포워드 검증 필요. PR-AUC/Precision@k, 비용 반영 PnL·샤프/MDD로 추가 평가 필요.


개선점
교차검증/임계값 문제: 지금은 “정확도”만 보고 있습니다. 이 모델은 “3개월 뒤 KOSPI보다 수익이 났는지”를 예측하는데, 확률이 대부분 0.5~0.55 근처라 0.6 이상 신호는 거의 없습니다. 그래서 단순 정확도로 성능을 판단하기 어렵고, 실제로는 다음을 봐야 합니다:

PR-AUC(정밀도-재현율 곡선), Precision@k(확률 상위 k개 신호의 정확도), 비용 반영한 전략 성과(수수료/슬리피지 포함 PnL, 샤프, MDD).
임계값 튜닝: 0.55~0.58 등으로 낮춰 신호를 늘리거나, “일자별 확률 상위 N개”만 진입하는 랭킹 방식으로 신호 수를 조절해야 합니다.
라벨/누수 문제: 모든 티커를 한꺼번에 시계열 CV에 넣으면 같은 날짜의 여러 티커가 섞여 학습됩니다. 이렇게 하면 “오늘 다른 종목들의 정보”가 미래 예측에 도움이 되는 것처럼 모델이 착각할 수 있어 결과가 부풀려질 수 있습니다. 해결책:

날짜 기준 워크포워드: 예를 들어 2017~2020 학습 → 2021 검증 → 2022 테스트처럼 시간 순으로 나눠 앞 시기로 뒤 시기를 예측하게 합니다.
티커 분리 검증: 티커 일부를 학습세트, 나머지를 검증세트로 분리해 “본 적 없는 종목”에 대해 예측 성능을 봅니다. 이렇게 하면 다른 종목 정보에 의존하는 누수를 줄일 수 있습니다.
즉, 지금 모델은 돌아가지만, “어디까지 믿을 수 있느냐”를 확인하려면 PR-AUC 등 더 적합한 지표를 보고, 시간순/티커 분리 방식으로 검증해 누수를 줄이고, 확률 임계값이나 랭킹 기반으로 신호를 튜닝해야 합니다.

MACD delta를 이용한 매수/매도는 단기추세에 좀 더 적합함
데이터 예시
2017-01-17,49544.53515625,49600.203125,47985.828125,48820.84765625,165851,40986.375,40814.04873550395,40209.32131984591,39575.99314655698,39603.36521536724,39822.34058951916,40938.881579194334,42194.70410760102,588.2218286891875,,224.76732568316686,027410.KS,2071.8701171875
2017-01-18,48876.515625,49321.859375,48264.16796875,48987.8515625,115906,41126.5859375,40918.22650075264,40376.095994646654,39723.66827843251,39663.09920814695,39865.10260400214,40941.98406600518,42184.07602723932,632.5908651553618,,306.3320335776059,027410.KS,2070.5400390625
2017-01-19,48765.1796875,50323.88671875,48598.17578125,50268.21875,273158,42201.48828125,41345.97912550176,40707.98479107454,39959.65076381989,39762.64372449413,39941.70528501846,40962.80225293071,42184.24924462998,745.8911135672606,,394.24384957553684,027410.KS,2072.7900390625
2017-01-20,50268.21875,52327.93359375,50268.21875,50769.23046875,462502,42622.09765625,41771.35327116784,41056.00602224281,40213.21750655133,39874.779325984564,40029.58713018179,40990.22868779963,42188.60598411128,859.7124386641444,,487.3375673932584,027410.KS,2065.610107421875
2017-01-23,50824.8984375,52105.26171875,50546.55859375,51492.9140625,162436,43229.65625,42257.4542641119,41451.21515456229,40500.497386879775,40006.343126926346,40134.50742919222,41027.24401940625,42198.9646932246,987.557298769505,,587.3815136685078,027410.KS,2065.989990234375
2017-01-24,51659.91796875,51715.5859375,50268.21875,50936.234375,123155,42762.30078125,42425.736436491265,41689.594359414594,40715.90723396266,40114.419897684136,40220.664588276086,41055.92264356896,42204.570027433816,1039.1845187378858,,677.7421146823834,027410.KS,2065.760009765625
2017-01-25,51381.578125,51492.9140625,50268.21875,50268.21875,120086,42201.48828125,42350.98574932751,41782.66527133921,40857.39077120431,40196.26556346123,40285.60949931621,41074.857548220716,42204.53932442453,1023.0531456363169,,746.8043208731701,027410.KS,2066.93994140625
2017-01-26,50435.22265625,51103.23828125,49822.875,50936.234375,172684,42762.30078125,42488.09075996834,41960.78081859571,41038.81077216104,40296.89439553138,40366.8124921665,41102.749171907155,42210.08918966658,1043.493371247503,,806.1421309480368,027410.KS,2083.590087890625


